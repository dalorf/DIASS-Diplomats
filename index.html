<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diploma 2 Final Year Awards</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 50%, #fff8e1 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            overflow-x: hidden;
        }

        .home-page {
            text-align: center;
            padding: 3rem 1rem;
            max-width: 100%;
        }

        .hero {
            position: relative;
            margin-bottom: 3rem;
        }

        .crown-icon {
            font-size: 5rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .sparkles {
            font-size: 2rem;
            position: absolute;
            top: -10px;
            right: 45%;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        h1 {
            font-size: 2.5rem;
            color: #1565c0;
            margin: 1rem 0;
            font-weight: bold;
        }

        h2 {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .tagline {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 2rem;
        }

        .countdown-box {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 1.5rem;
            padding: 2rem;
            max-width: 400px;
            margin: 0 auto 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #74B9FF;
        }

        .countdown-title {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .countdown-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }

        .countdown-item {
            background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%);
            border-radius: 0.75rem;
            padding: 1rem;
            color: white;
        }

        .countdown-value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .countdown-label {
            font-size: 0.7rem;
            opacity: 0.9;
            margin-top: 0.25rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 2rem;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(33, 150, 243, 0.3);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(33, 150, 243, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .info-section {
            max-width: 600px;
            margin: 3rem auto;
            padding: 0 1rem;
        }

        .info-card {
            background: white;
            border-radius: 2rem;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #74B9FF;
        }

        .info-title {
            font-size: 1.5rem;
            color: #1565c0;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .info-step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            background: #e3f2fd;
            border-radius: 1rem;
            margin-bottom: 1rem;
        }

        .info-step:nth-child(2) {
            background: #fff8e1;
        }

        .info-step:nth-child(3) {
            background: #e8f5e9;
        }

        .step-number {
            width: 2rem;
            height: 2rem;
            background: #1e88e5;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .info-step:nth-child(2) .step-number {
            background: #ffa726;
        }

        .info-step:nth-child(3) .step-number {
            background: #66bb6a;
        }

        .step-content h4 {
            color: #333;
            margin-bottom: 0.25rem;
        }

        .step-content p {
            color: #666;
            font-size: 0.9rem;
        }

        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .login-card {
            background: white;
            border-radius: 2rem;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            border: 1px solid #74B9FF;
        }

        .login-icon {
            width: 4rem;
            height: 4rem;
            background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
        }

        .login-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .login-subtitle {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .welcome-back {
            background: #e8f5e9;
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .welcome-back h4 {
            color: #4caf50;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .welcome-back p {
            color: #666;
            font-size: 0.85rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: #333;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .form-group input {
            width: 100%;
            padding: 0.875rem;
            border: 1px solid #ddd;
            border-radius: 0.75rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #42a5f5;
            box-shadow: 0 0 0 3px rgba(66, 165, 245, 0.1);
        }

        .error-message {
            color: #f44336;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: none;
            background: #ffebee;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }

        .error-message.show {
            display: block;
        }

        .warning-message {
            color: #ff9800;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: none;
            background: #fff3e0;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }

        .warning-message.show {
            display: block;
        }

        .btn-back {
            width: 100%;
            background: transparent;
            color: #1e88e5;
            border: none;
            padding: 0.75rem;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 1rem;
        }

        .btn-back:hover {
            text-decoration: underline;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-bottom: 2px solid #e0e0e0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-tab {
            flex: 1;
            padding: 1rem;
            background: transparent;
            border: none;
            font-size: 0.95rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .nav-tab.active {
            color: #1e88e5;
            border-bottom-color: #1e88e5;
        }

        .nav-tab:hover {
            background: #f5f9ff;
        }

        .voting-page {
            min-height: 100vh;
            padding-bottom: 5rem;
        }

        .voting-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e0e0e0;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .header-info h2 {
            font-size: 1.25rem;
            color: #333;
        }

        .header-info p {
            font-size: 0.75rem;
            color: #666;
        }

        .btn-logout {
            background: #f5f5f5;
            border: none;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: #e0e0e0;
        }

        .vote-counter {
            background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%);
            color: white;
            border-radius: 1rem;
            padding: 1rem;
            position: relative;
        }

        .live-badge {
            position: absolute;
            top: -8px;
            right: 10px;
            background: #4caf50;
            color: white;
            font-size: 0.7rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-weight: bold;
            animation: livePulse 2s infinite;
        }

        @keyframes livePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .live-badge::before {
            content: "🔴";
            margin-right: 0.25rem;
        }

        .vote-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .vote-stat {
            text-align: center;
        }

        .vote-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .vote-stat-label {
            font-size: 0.7rem;
            opacity: 0.9;
        }

        .votes-progress {
            background: rgba(255,255,255,0.2);
            border-radius: 0.5rem;
            height: 0.5rem;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .votes-progress-bar {
            background: #ffd700;
            height: 100%;
            transition: width 0.3s ease;
        }

        .search-section {
            padding: 1rem;
            background: white;
        }

        .search-input {
            width: 100%;
            padding: 0.875rem;
            border: 1px solid #ddd;
            border-radius: 0.75rem;
            font-size: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .search-input:focus {
            outline: none;
            border-color: #42a5f5;
            box-shadow: 0 2px 10px rgba(66, 165, 245, 0.2);
        }

        .categories-section {
            padding: 1rem;
        }

        .category-card {
            background: white;
            border-radius: 1rem;
            margin-bottom: 0.75rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 1px solid #e0e0e0;
            overflow: hidden;
        }

        .category-header {
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .category-header:hover {
            background: #f5f9ff;
        }

        .category-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
        }

        .category-icon {
            font-size: 1.75rem;
        }

        .category-info {
            flex: 1;
            min-width: 0;
        }

        .category-title {
            font-size: 0.95rem;
            font-weight: bold;
            color: #333;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .category-count {
            font-size: 0.75rem;
            color: #666;
        }

        .category-status {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            margin-right: 0.5rem;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .category-status.voted {
            background: #e8f5e9;
            color: #4caf50;
        }

        .category-status.not-voted {
            background: #fff3e0;
            color: #ff9800;
        }

        .category-arrow {
            font-size: 1.25rem;
            color: #666;
            transition: transform 0.3s ease;
        }

        .category-card.expanded .category-arrow {
            transform: rotate(90deg);
        }

        .nominees-section {
            border-top: 1px solid #e0e0e0;
            padding: 1rem;
            background: linear-gradient(to bottom, #f5f9ff, white);
            display: none;
        }

        .category-card.expanded .nominees-section {
            display: block;
        }

        .nominee-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.875rem;
            background: white;
            border-radius: 0.75rem;
            margin-bottom: 0.5rem;
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .nominee-item:hover {
            border-color: #74B9FF;
        }

        .nominee-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
            min-width: 0;
        }

        .nominee-avatar {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.875rem;
            flex-shrink: 0;
        }

        .nominee-name {
            font-size: 0.95rem;
            font-weight: 500;
            color: #333;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .btn-vote {
            background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .btn-vote:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(66, 165, 245, 0.3);
        }

        .btn-vote.voted {
            background: #e8f5e9;
            color: #4caf50;
            cursor: not-allowed;
        }

        .btn-vote.voted:hover {
            transform: none;
            box-shadow: none;
        }

        .leaderboard-section {
            padding: 1rem;
        }

        .leaderboard-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 1px solid #e0e0e0;
        }

        .leaderboard-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: #f5f9ff;
            border-radius: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .leaderboard-rank {
            width: 2rem;
            height: 2rem;
            background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.875rem;
            flex-shrink: 0;
        }

        .leaderboard-rank.gold {
            background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%);
        }

        .leaderboard-rank.silver {
            background: linear-gradient(135deg, #c0c0c0 0%, #a8a8a8 100%);
        }

        .leaderboard-rank.bronze {
            background: linear-gradient(135deg, #cd7f32 0%, #b87333 100%);
        }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }

        .leaderboard-votes {
            font-size: 0.8rem;
            color: #666;
        }

        .leaderboard-bar {
            background: rgba(66, 165, 245, 0.2);
            border-radius: 0.25rem;
            height: 0.5rem;
            margin-top: 0.25rem;
            overflow: hidden;
        }

        .leaderboard-bar-fill {
            background: linear-gradient(90deg, #42a5f5 0%, #1e88e5 100%);
            height: 100%;
            transition: width 0.5s ease;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 2rem;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }

        .modal-icon {
            width: 4rem;
            height: 4rem;
            background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .modal-text {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        .modal-votes {
            background: #e3f2fd;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .modal-votes p:first-child {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .modal-votes p:last-child {
            font-size: 2rem;
            color: #1e88e5;
            font-weight: bold;
        }

        .modal-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            border: none;
            padding: 0.875rem;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .admin-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1001;
            background: linear-gradient(135deg, #222 0%, #1565c0 100%);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            font-size: 1.5rem;
            box-shadow: 0 4px 16px rgba(30,136,229,0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .admin-btn:hover {
            background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(30,136,229,0.4);
        }

        .admin-btn:active {
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .countdown-value {
                font-size: 1.5rem;
            }

            .info-card {
                padding: 1.5rem;
            }

            .nav-tab {
                font-size: 0.85rem;
                padding: 0.875rem 0.5rem;
            }

            .category-title {
                font-size: 0.85rem;
            }

            .nominee-name {
                font-size: 0.85rem;
            }

            .btn-vote {
                padding: 0.4rem 0.75rem;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .category-header {
                padding: 0.75rem;
            }

            .category-icon {
                font-size: 1.5rem;
            }

            .nominee-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .btn-vote {
                width: 100%;
                margin-top: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div id="homePage" class="container">
        <div class="home-page">
            <div class="hero">
                <div class="crown-icon">👑</div>
                <div class="sparkles">✨</div>
            </div>

            <h1>Final Year Diplomat Awards</h1>
            <h2>Lagos State University DIASS Year 2</h2>
            <p class="tagline">Celebrating Excellence, Style & Spirit</p>

            <div class="countdown-box">
                <div class="countdown-title">⏰ Voting Closes In</div>
                <div class="countdown-grid">
                    <div class="countdown-item">
                        <div class="countdown-value" id="days">7</div>
                        <div class="countdown-label">Days</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-value" id="hours">12</div>
                        <div class="countdown-label">Hours</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-value" id="minutes">30</div>
                        <div class="countdown-label">Mins</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-value" id="seconds">0</div>
                        <div class="countdown-label">Secs</div>
                    </div>
                </div>
            </div>

            <button class="btn-primary" onclick="showLogin()">Start Voting</button>

            <div class="info-section">
                <div class="info-card">
                    <div class="info-title">⭐ How It Works</div>
                    <div class="info-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Free Votes for All Categories</h4>
                            <p>Vote once in each of the 18 categories for free</p>
                        </div>
                    </div>
                    <div class="info-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Purchase Extra Votes</h4>
                            <p>Buy additional votes to support your favorites even more</p>
                        </div>
                    </div>
                    <div class="info-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Watch the Leaderboard</h4>
                            <p>See live results and track who's leading in each category</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="loginPage" class="container hidden">
        <div class="login-page">
            <div class="login-card">
                <div class="login-icon">🏆</div>
                <div style="text-align: center;">
                    <h2 class="login-title">Diplomat Verification</h2>
                    <p class="login-subtitle">Enter your details to access voting</p>
                </div>

                <div id="welcomeBackMessage" class="welcome-back hidden">
                    <h4>Welcome Back!</h4>
                    <p id="welcomeBackText"></p>
                </div>

                <div class="form-group">
                    <label>Student Name</label>
                    <input type="text" id="nameInput" placeholder="e.g., Solomon Stephen or Daibu Mohammed">
                    <div class="error-message" id="nameError">Name not recognized</div>
                </div>

                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="emailInput" placeholder="yourname@example.com">
                    <div class="error-message" id="emailError">Please enter a valid email</div>
                    <div class="warning-message" id="rateLimitWarning"></div>
                </div>

                <button class="btn-primary" id="loginBtn" style="width: 100%;" onclick="handleLogin()">Verify & Continue</button>
                <button class="btn-back" onclick="showHome()">← Back to Home</button>
            </div>
        </div>
    </div>

    <div id="mainApp" class="container hidden">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('voting', event)">🗳️ Vote</button>
            <button class="nav-tab" onclick="switchTab('leaderboard', event)">📊 Leaderboard</button>
        </div>

        <div id="votingSection">
            <div class="voting-page">
                <div class="voting-header">
                    <div class="header-top">
                        <div class="header-info">
                            <h2>DIASS Diplomat Awards</h2>
                            <p id="userName"></p>
                        </div>
                        <button class="btn-logout" onclick="handleLogout()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                        </button>
                    </div>

                    <div class="vote-counter">
                        <div class="live-badge">ONGOING</div>
                        <div class="vote-stats">
                            <div class="vote-stat">
                                <div class="vote-stat-value" id="categoriesVoted">0</div>
                                <div class="vote-stat-label">Categories</div>
                            </div>
                            <div class="vote-stat">
                                <div class="vote-stat-value" id="freeVotesLeft">18</div>
                                <div class="vote-stat-label">Free Left</div>
                            </div>
                            <div class="vote-stat">
                                <div class="vote-stat-value" id="extraVotesPurchased">0</div>
                                <div class="vote-stat-label">Extra Votes</div>
                            </div>
                        </div>
                        <div class="votes-progress">
                            <div class="votes-progress-bar" id="votingProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="search-section">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search categories or nominees..." onkeyup="filterCategories()">
                </div>

                <div class="categories-section" id="categoriesContainer">
                    <div class="loading">Loading categories...</div>
                </div>
            </div>
        </div>

        <div id="leaderboardSection" class="hidden">
            <div class="leaderboard-section" id="leaderboardContainer">
                <div class="loading">Loading leaderboard...</div>
            </div>
        </div>
    </div>

    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-icon">⭐</div>
            <h3 class="modal-title">Purchase Extra Vote</h3>
            <p class="modal-text">You've already voted in this category. Buy an extra vote to support this nominee even more!</p>

            <div class="modal-votes">
                <p>Extra Votes Purchased</p>
                <p id="modalExtraVotes">0</p>
            </div>

            <div class="modal-actions">
                <button class="btn-primary" style="width: 100%;" onclick="handlePayment()">Pay & Vote Now</button>
                <button class="btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <button class="admin-btn" title="Admin Panel" onclick="window.location.href='admin.html'">⚙️</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD1tYPF1ZlGAe7gzXxlo6rjw2QMeaZ_MHo",
            authDomain: "diass-year-2-dipards.firebaseapp.com",
            databaseURL: "https://diass-year-2-dipards-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "diass-year-2-dipards",
            storageBucket: "diass-year-2-dipards.firebasestorage.app",
            messagingSenderId: "1093369035381",
            appId: "1:1093369035381:web:129a5fb1b1a029efa3963c"
        };

        let app, db;

        try {
            app = initializeApp(firebaseConfig);
            db = getDatabase(app);
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            alert('Failed to connect to database. Please refresh the page.');
            throw error; // Stop the app if initialization fails
        }
        // Predefined list of registered students
        // In a real application, this should come from a secure backend or database        

        const registeredStudents = [
            "Solomon Stephen Sunday", "Emeghara Favour Chiamaka", "Fasoro Boluwatife Esther",
            "Eroje Blessed Ifeoma", "Fakunle Zion Ezekiel", "Adeniran Deborah Taiwo",
            "Gandonu Victoria Nifemi", "Agboyinu Omowunmi Mautin", "Salimon Farouk Ayomide",
            "Ogunlade Pelumi Victoria", "Salawu Precious Oluwanifemi", "Abioye Kowiat Oyindamola",
            "Kadiri Favour Hawawu", "Nicholas Winner Chioma", "Abdulquari Olayinka Obadin",
            "Nnawugwu Ugochukwu", "Adejumobi Damilola Favour", "Daibu Mohammed Fareedah",
            "Solola Olalomo", "King Gloria Temitope", "Precious Adanna Sunday",
            "Nwanedo Chidera Testimony", "Omoboye Kikelomo Omotola", "Asegba Faith",
            "Omitiran Mary Jolade", "Adelowo Eniola Abbey", "Adebayo Ademola Julius",
            "Adisa Ismaila Temitope", "Christian Ogala", "Donatus Chidera Deborah",
            "Iyanuoluwa Gift", "Olanrewaju Boluwatife Ololatide", "Bakare Eniola Ayomide",
            "Olaoye Zainab Omotolani"
        ];

        const categories = [
            { name: "Most Brilliant Diplomat", icon: "🎓", nominees: ["Ogunlade Pelumi", "Christian Ogala", "Daibu Fareedah", "Solomon Stephen", "Nicholas Mirabel"] },
            { name: "Most Handsome Diplomat", icon: "🎩", nominees: ["Adebayo Julius", "Salimon Farouq", "Solomon Stephen", "Olanrewaju Bolu"] },
            { name: "Most Beautiful Diplomat", icon: "👗", nominees: ["Nwanedo Chidera", "Donatus Chidera", "Shobayo Simbi", "Nicholas Mirabel", "Seyi Gandonu"] },
            { name: "Most Reserved Diplomat (Male)", icon: "🤐", nominees: ["MOR", "Christian Ogala", "Biggie"] },
            { name: "Most Reserved Diplomat (Female)", icon: "🤫", nominees: ["Treasure Ebube", "Solomon Joy", "Temmy"] },
            { name: "Most Talented Diplomat", icon: "🎭", nominees: ["Ernest Henry", "Bolu Olanrewaju", "Ugochukwu Christsanctus", "Solomon Stephen"] },
            { name: "Most Creative Diplomat", icon: "🎨", nominees: ["Daibu Fareedah", "MOR", "Solomon Stephen", "Ernest Henry"] },
            { name: "Most Social Diplomat (Male)", icon: "🎉", nominees: ["Ernest Henry", "Ayo Salimon Farouq", "Ugo Christsanctus"] },
            { name: "Most Social Diplomat (Female)", icon: "💃", nominees: ["Debby Donatus", "Kowiat", "Abimbola"] },
            { name: "Most Entrepreneurial Diplomat", icon: "💼", nominees: ["Nicholas Mirabel", "Debby Donatus", "MOH", "Olakunle Kazeem"] },
            { name: "Most Popular Diplomat (Male)", icon: "⭐", nominees: ["Henry Ernest", "Ugochukwu Christsanctus", "Adebayo Julius"] },
            { name: "Most Popular Diplomat (Female)", icon: "✨", nominees: ["Ashley Favour", "Shobayo Simbi", "Gift"] },
            { name: "Favorite Diploma Lecturer", icon: "📚", nominees: ["Mr. Wilson", "Prof. Falode", "Dr. Shekoni"] },
            { name: "Most Expensive Diplomat (Male)", icon: "💎", nominees: ["Kazeem Olakunle", "Ayo Briefcase Guy"] },
            { name: "Most Expensive Diplomat (Female)", icon: "💍", nominees: ["Tess Nwanedo Chidera", "Chidera Donatus"] },
            { name: "Diploma Fashionista (Male)", icon: "🕴️", nominees: ["Henry Ernest", "Bolu Olanrewaju", "Christian Farouq", "Emmy Indebted"] },
            { name: "Diploma Fashionista (Female)", icon: "👠", nominees: ["Kowiat", "Tess", "Ifeoma", "Simbi"] },
            { name: "Most Outstanding Diplomat", icon: "🏆", nominees: ["Solomon Stephen", "Mr. Chris", "Ernest Henry", "Nicholas Mirabel", "Daibu Fareedah"] }
        ];

        let currentUser = { name: '', email: '', fullName: '' };
        let userVotes = {};
        let extraVotesPurchased = 0;
        let pendingVote = null;
        let votingLocked = false;
        let allVotes = {};
        
        const rateLimits = {
            login: { attempts: 0, lastAttempt: 0, maxAttempts: 5, cooldown: 300000 },
            vote: { attempts: 0, lastAttempt: 0, maxAttempts: 20, cooldown: 60000 }
        };

        function checkRateLimit(action) {
            const limit = rateLimits[action];
            const now = Date.now();
            
            if (now - limit.lastAttempt > limit.cooldown) {
                limit.attempts = 0;
            }
            
            if (limit.attempts >= limit.maxAttempts) {
                const remainingTime = Math.ceil((limit.cooldown - (now - limit.lastAttempt)) / 1000);
                return {
                    allowed: false,
                    message: `Too many attempts. Please wait ${Math.ceil(remainingTime / 60)} minute(s) before trying again.`
                };
            }
            
            limit.attempts++;
            limit.lastAttempt = now;
            return { allowed: true };
        }

        let timeLeft = { days: 7, hours: 12, minutes: 30, seconds: 0 };
        function updateCountdown() {
            if (timeLeft.seconds > 0) {
                timeLeft.seconds--;
            } else if (timeLeft.minutes > 0) {
                timeLeft.minutes--;
                timeLeft.seconds = 59;
            } else if (timeLeft.hours > 0) {
                timeLeft.hours--;
                timeLeft.minutes = 59;
                timeLeft.seconds = 59;
            } else if (timeLeft.days > 0) {
                timeLeft.days--;
                timeLeft.hours = 23;
                timeLeft.minutes = 59;
                timeLeft.seconds = 59;
            }
            document.getElementById('days').textContent = timeLeft.days;
            document.getElementById('hours').textContent = timeLeft.hours;
            document.getElementById('minutes').textContent = timeLeft.minutes;
            document.getElementById('seconds').textContent = timeLeft.seconds;
        }
        setInterval(updateCountdown, 1000);

        window.findMatchingStudent = function(input) {
            const inputKeywords = input.toLowerCase().trim().split(/\s+/).filter(w => w.length > 2);
            if (inputKeywords.length === 0) return null;

            for (const student of registeredStudents) {
                const studentKeywords = student.toLowerCase().split(/\s+/);
                const matchCount = inputKeywords.filter(kw => 
                    studentKeywords.some(sw => sw.includes(kw) || kw.includes(sw))
                ).length;
                
                if (matchCount >= Math.min(inputKeywords.length, 2)) {
                    return student;
                }
            }
            return null;
        };

        window.showHome = function() {
            document.getElementById('homePage').classList.remove('hidden');
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        };

        window.showLogin = function() {
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        };

        window.showMainApp = async function() {
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            await loadUserData();
            renderCategories();
            loadAllVotes();
        };

        window.handleLogin = async function() {
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.disabled = true;
            loginBtn.textContent = 'Verifying...';

            const rateCheck = checkRateLimit('login');
            if (!rateCheck.allowed) {
                document.getElementById('rateLimitWarning').textContent = '⚠️ ' + rateCheck.message;
                document.getElementById('rateLimitWarning').classList.add('show');
                loginBtn.disabled = false;
                loginBtn.textContent = 'Verify & Continue';
                return;
            }

            document.getElementById('rateLimitWarning').classList.remove('show');
            const nameInput = document.getElementById('nameInput').value.trim();
            const email = document.getElementById('emailInput').value.trim().toLowerCase();
            
            document.getElementById('nameError').classList.remove('show');
            document.getElementById('emailError').classList.remove('show');
            
            let hasError = false;
            
            if (!nameInput) {
                document.getElementById('nameError').textContent = 'Please enter your name';
                document.getElementById('nameError').classList.add('show');
                hasError = true;
            } else {
                const matchedStudent = window.findMatchingStudent(nameInput);
                if (!matchedStudent) {
                    document.getElementById('nameError').textContent = 'Name not recognized. Try entering different parts of your name.';
                    document.getElementById('nameError').classList.add('show');
                    hasError = true;
                } else {
                    currentUser.fullName = matchedStudent;
                }
            }
            
            if (!email || !email.includes('@') || !email.includes('.')) {
                document.getElementById('emailError').textContent = 'Please enter a valid email address';
                document.getElementById('emailError').classList.add('show');
                hasError = true;
            }
            
            if (hasError) {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Verify & Continue';
                return;
            }

            try {
                const nameBindingRef = ref(db, 'nameEmailBindings');
                const bindingSnapshot = await get(nameBindingRef);
                
                if (bindingSnapshot.exists()) {
                    const bindings = bindingSnapshot.val();
                    const normalizedName = currentUser.fullName.toLowerCase().replace(/\s+/g, '');
                    
                    if (bindings[normalizedName]) {
                        const registeredEmail = bindings[normalizedName];
                        
                        if (registeredEmail !== email) {
                            document.getElementById('emailError').textContent = 
                                `⚠️ This name is already registered with a different email. Please use the correct email.`;
                            document.getElementById('emailError').classList.add('show');
                            loginBtn.disabled = false;
                            loginBtn.textContent = 'Verify & Continue';
                            return;
                        }
                    } else {
                        await set(ref(db, `nameEmailBindings/${normalizedName}`), email);
                    }
                } else {
                    const normalizedName = currentUser.fullName.toLowerCase().replace(/\s+/g, '');
                    await set(ref(db, `nameEmailBindings/${normalizedName}`), email);
                }
                
                rateLimits.login.attempts = 0;
                currentUser.name = nameInput;
                currentUser.email = email;
                document.getElementById('userName').textContent = currentUser.fullName;
                const emailKey = email.replace(/[.#$[\]]/g, '_');
                await update(ref(db, `students/${emailKey}`), {
                    fullName: currentUser.fullName,
                    email: email,
                    lastLogin: Date.now(),
                    status: 'online'
                });
                
                showMainApp();
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('emailError').textContent = 'An error occurred. Please try again.';
                document.getElementById('emailError').classList.add('show');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Verify & Continue';
            }
        };

        async function loadUserData() {
            const emailKey = currentUser.email.replace(/[.#$[\]]/g, '_');
            const userRef = ref(db, `userVotes/${emailKey}`);
            const snapshot = await get(userRef);
            
            if (snapshot.exists()) {
                const data = snapshot.val();
                userVotes = data.votes || {};
                extraVotesPurchased = data.extraVotes || 0;
                
                const votesCount = Object.keys(userVotes).length;
                const remaining = 18 - votesCount;
                
                if (votesCount > 0) {
                    document.getElementById('welcomeBackMessage').classList.remove('hidden');
                    document.getElementById('welcomeBackText').textContent = 
                        `You have ${votesCount} vote${votesCount !== 1 ? 's' : ''} cast. ${remaining} categor${remaining !== 1 ? 'ies' : 'y'} remaining!`;
                }
            }
            updateVoteUI();
        }

        function loadAllVotes() {
            const votesRef = ref(db, 'categoryVotes');
            onValue(votesRef, (snapshot) => {
                if (snapshot.exists()) {
                    allVotes = snapshot.val();
                } else {
                    allVotes = {};
                    categories.forEach(cat => {
                        allVotes[cat.name] = {};
                        cat.nominees.forEach(nom => {
                            allVotes[cat.name][nom] = 0;
                        });
                    });
                }
                if (!document.getElementById('leaderboardSection').classList.contains('hidden')) {
                    renderLeaderboard();
                }
            });
        }

        window.handleLogout = async function() {
            if (confirm('Are you sure you want to logout? Your votes are saved and you can resume anytime.')) {
                const emailKey = currentUser.email.replace(/[.#$[\]]/g, '_');
                await update(ref(db, `students/${emailKey}`), {
                    status: 'offline',
                    lastActivity: Date.now()
                });
                
                currentUser = { name: '', email: '', fullName: '' };
                userVotes = {};
                extraVotesPurchased = 0;
                document.getElementById('nameInput').value = '';
                document.getElementById('emailInput').value = '';
                document.getElementById('welcomeBackMessage').classList.add('hidden');
                showHome();
            }
        };

        window.switchTab = function(tab, event) {
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('votingSection').classList.toggle('hidden', tab !== 'voting');
            document.getElementById('leaderboardSection').classList.toggle('hidden', tab !== 'leaderboard');
            
            if (tab === 'leaderboard') renderLeaderboard();
        };

        window.getInitials = function(name) {
            return name.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase();
        };

        window.renderCategories = function() {
            const container = document.getElementById('categoriesContainer');
            container.innerHTML = '';

            categories.forEach((category, idx) => {
                const hasVoted = userVotes[category.name] !== undefined;
                const card = document.createElement('div');
                card.className = 'category-card';
                card.setAttribute('data-category', category.name.toLowerCase());
                
                const statusHTML = hasVoted 
                    ? '<span class="category-status voted">✓ Voted</span>'
                    : '<span class="category-status not-voted">Not Voted</span>';
                
                card.innerHTML = `
                    <div class="category-header" onclick="toggleCategory(${idx})">
                        <div class="category-left">
                            <div class="category-icon">${category.icon}</div>
                            <div class="category-info">
                                <div class="category-title">${category.name}</div>
                                <div class="category-count">${category.nominees.length} nominees</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            ${statusHTML}
                            <div class="category-arrow">›</div>
                        </div>
                    </div>
                    <div class="nominees-section">
                        ${category.nominees.map(nominee => {
                            const hasVotedForNominee = userVotes[category.name] === nominee;
                            return `
                                <div class="nominee-item" data-nominee="${nominee.toLowerCase()}">
                                    <div class="nominee-left">
                                        <div class="nominee-avatar">${window.getInitials(nominee)}</div>
                                        <div class="nominee-name">${nominee}</div>
                                    </div>
                                    <button 
                                        class="btn-vote ${hasVotedForNominee ? 'voted' : ''}" 
                                        onclick="handleVote('${category.name}', '${nominee}')"
                                        ${votingLocked ? 'disabled' : ''}
                                    >
                                        ${hasVotedForNominee ? '✓ Voted' : 'Vote'}
                                    </button>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                container.appendChild(card);
            });
        };

        window.toggleCategory = function(idx) {
            const cards = document.querySelectorAll('.category-card');
            cards[idx].classList.toggle('expanded');
        };

        window.handleVote = async function(category, nominee) {
            const rateCheck = checkRateLimit('vote');
            if (!rateCheck.allowed) {
                alert('🚫 ' + rateCheck.message);
                return;
            }

            if (votingLocked) {
                alert('Voting is currently locked by admin');
                return;
            }

            const hasVotedInCategory = userVotes[category] !== undefined;
            
            if (!hasVotedInCategory) {
                userVotes[category] = nominee;
                
                const emailKey = currentUser.email.replace(/[.#$[\]]/g, '_');
                await set(ref(db, `userVotes/${emailKey}`), {
                    votes: userVotes,
                    extraVotes: extraVotesPurchased,
                    fullName: currentUser.fullName,
                    lastVote: Date.now()
                });
                
                const voteRef = ref(db, `categoryVotes/${category}/${nominee}`);
                const snapshot = await get(voteRef);
                const currentVotes = snapshot.exists() ? snapshot.val() : 0;
                await set(voteRef, currentVotes + 1);
                
                await update(ref(db, `students/${emailKey}`), {
                    votesCount: Object.keys(userVotes).length,
                    lastActivity: Date.now()
                });
                
                rateLimits.vote.attempts = 0;
                updateVoteUI();
                renderCategories();
                alert(`✅ Vote cast for ${nominee}!`);
            } else {
                pendingVote = { category, nominee };
                showPaymentModal();
            }
        };

        window.showPaymentModal = function() {
            document.getElementById('modalExtraVotes').textContent = extraVotesPurchased;
            document.getElementById('paymentModal').classList.add('active');
        };

        window.closeModal = function() {
            document.getElementById('paymentModal').classList.remove('active');
            pendingVote = null;
        };

        window.handlePayment = async function() {
            if (pendingVote) {
                extraVotesPurchased++;
                
                const emailKey = currentUser.email.replace(/[.#$[\]]/g, '_');
                await set(ref(db, `userVotes/${emailKey}`), {
                    votes: userVotes,
                    extraVotes: extraVotesPurchased,
                    fullName: currentUser.fullName,
                    lastVote: Date.now()
                });
                
                const voteRef = ref(db, `categoryVotes/${pendingVote.category}/${pendingVote.nominee}`);
                const snapshot = await get(voteRef);
                const currentVotes = snapshot.exists() ? snapshot.val() : 0;
                await set(voteRef, currentVotes + 1);
                
                updateVoteUI();
                alert(`💰 Extra vote purchased and cast for ${pendingVote.nominee}!`);
            }
            closeModal();
        };

        function updateVoteUI() {
            const categoriesVoted = Object.keys(userVotes).length;
            const freeVotesLeft = 18 - categoriesVoted;
            const progress = (categoriesVoted / 18) * 100;

            document.getElementById('categoriesVoted').textContent = categoriesVoted;
            document.getElementById('freeVotesLeft').textContent = freeVotesLeft;
            document.getElementById('extraVotesPurchased').textContent = extraVotesPurchased;
            document.getElementById('votingProgress').style.width = progress + '%';
        }

        window.filterCategories = function() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryCards = document.querySelectorAll('.category-card');

            categoryCards.forEach(card => {
                const categoryName = card.getAttribute('data-category');
                const nomineeItems = card.querySelectorAll('.nominee-item');
                let categoryMatch = categoryName.includes(searchTerm);
                let hasVisibleNominee = false;

                nomineeItems.forEach(item => {
                    const nomineeName = item.getAttribute('data-nominee');
                    if (nomineeName.includes(searchTerm)) {
                        item.style.display = 'flex';
                        hasVisibleNominee = true;
                    } else {
                        item.style.display = 'none';
                    }
                });

                if (categoryMatch || hasVisibleNominee || searchTerm === '') {
                    card.style.display = 'block';
                    if (searchTerm !== '') {
                        nomineeItems.forEach(item => item.style.display = 'flex');
                    }
                } else {
                    card.style.display = 'none';
                }
            });
        };

        window.renderLeaderboard = function() {
            const container = document.getElementById('leaderboardContainer');
            container.innerHTML = '';

            categories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'leaderboard-card';
                
                const categoryVotes = allVotes[category.name] || {};
                const sortedNominees = category.nominees
                    .map(nom => ({ name: nom, votes: categoryVotes[nom] || 0 }))
                    .sort((a, b) => b.votes - a.votes);
                
                const maxVotes = sortedNominees[0].votes || 1;
                
                card.innerHTML = `
                    <div class="leaderboard-title">${category.icon} ${category.name}</div>
                    ${sortedNominees.map((nominee, idx) => {
                        let rankClass = '';
                        if (idx === 0) rankClass = 'gold';
                        else if (idx === 1) rankClass = 'silver';
                        else if (idx === 2) rankClass = 'bronze';
                        
                        const percentage = maxVotes > 0 ? (nominee.votes / maxVotes) * 100 : 0;
                        
                        return `
                            <div class="leaderboard-item">
                                <div class="leaderboard-rank ${rankClass}">${idx + 1}</div>
                                <div class="leaderboard-info">
                                    <div class="leaderboard-name">${nominee.name}</div>
                                    <div class="leaderboard-votes">${nominee.votes} vote${nominee.votes !== 1 ? 's' : ''}</div>
                                    <div class="leaderboard-bar">
                                        <div class="leaderboard-bar-fill" style="width: ${percentage}%"></div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                `;
                
                container.appendChild(card);
            });
        };

        document.addEventListener('DOMContentLoaded', function() {
            showHome();
        });
    </script>
</body>
</html>
